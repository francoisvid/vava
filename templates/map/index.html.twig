{% extends 'base.html.twig' %}
 
{% block title %}Hello {{ controller_name }}!{% endblock %}


{% block body %}

    <style>
        #map {
            height: 400px;
            width: 70%;
        }
    </style>

    {#<div class="container">#}

    <div class="jumbotron" style="background-image:url('{{ asset('./build/image/background.png') }}');">
            <div class="container" style="text-align: center">
                <h1 class="display-3">Bienvenue sur Signe</h1>
            </div>
    </div>
    <div class="container">
        <div class="right menu">
            <div class="ui search">
                <div class="ui icon input">
                    <input class="prompt" type="text" id="lat" placeholder="lattitude">
                    <input class="prompt" type="text" id="lng" placeholder="longitude">
                    <i class="search icon"></i>
                </div>
                <div class="results"></div>
            </div>
        </div>
    </div>
        <div id="map" style="display: inline-block; height: 380px;">

        </div>


        <div id="liste" class="ui middle aligned divided list" style=" max-height: 380px;overflow: scroll;display: inline-block; margin-left: 10px; width: 320px; position: absolute;">
            <script>
                $(document).ready(function(){
                    $("#liste").append(
                        $("<div>").addClass("item").append(
                            $("<div>").addClass("right floated content").append(
                                $("<button>").attr("id", "addFav").addClass("ui button").text("Plus...")
                            ).append(
                                $("<div>").addClass("ui flowing popup top left transition hidden").append(
                                    $("<div>").addClass("ui three column divided center aligned grid")
                                        .append($("<a>").addClass("ui primary button").append($("<i>").addClass("star icon").text("Favoris")))
                                        .append($("<a>").addClass("ui primary button").append("<i>").addClass("phone icon").text("Appeler"))
                                        .append($("<a>").addClass("ui primary button").append("<i>").addClass("location arrow icon").text("Itineraire"))
                                )
                            ))
                            .append($("<img>").addClass("ui avatar image").attr("src", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTUBcxNrQj6HRPONKxeoEpw_PfQQYWT5g7iUFwvL0nOgjucd3EYw"))
                            .append($("<div>").addClass("content").text("lena")))
                });
            </script>
        </div>
    {#</div>#}



{% endblock %}

{% block javascripts %}


    <script>

        {#script YANNIS#}

        {#var locations = [#}
            {#{% for d in data %}#}
            {#{% set counter = ( counter | default(0) ) + 1 %}#}

            {#{% if not app.user %}#}

            {#['{{ d.nom }} - {{ d.rue }} <hr><div class="ui buttons center aligned">\n' +#}
            {#'  <a class="ui primary button"><i class="star icon"></i> Favoris</a>\n' +#}
            {#'  <a class="ui primary button" href"tel:{{ d.tel }}"><i class="phone icon"></i> Appler</a>\n' +#}
            {#'  <a class="ui primary button"><i class="location arrow icon"></i> Itinéraire</a>\n' +#}
            {#'</div>',  {{ d.la }},  {{ d.lo }}, {{ counter }}],#}

            {#{% else %}#}

            {#['{{ d.nom }} - {{ d.rue }} <hr><div class="ui buttons center aligned">\n' +#}
            {#'  <a class="ui primary button" href="{{ path('favoris_add', { 'Utilisateur' : app.user.id, 'Entreprise': d.id }) }}"><i class="star icon"></i> Favoris</a>\n' +#}
            {#'  <a class="ui primary button" href"tel:{{ d.tel }}"><i class="phone icon"></i> Appler</a>\n' +#}
            {#'  <a class="ui primary button"><i class="location arrow icon"></i> Itinéraire</a>\n' +#}
            {#'</div>',  {{ d.la }},  {{ d.lo }}, {{ counter }}],#}

            {#{% endif %}#}


            {#{% endfor %}#}


        {#];#}
        // var locations = [ "" ];
    $(function(){
        var latlng = new google.maps.LatLng(43.6759607, 4.1334817);
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var marker = new google.maps.Marker({
            position : latlng,
            map: map,
            title : 'curseur de base',
            draggable: true
        });

        var geocoder = new google.maps.Geocoder();
        //
        //
        google.maps.event.addListener(marker, 'draggable', function () {

            setPosition(marker);
            
        })


        $('#search').keypress(function(e) {
            if (e.keyCode == 13){
                var request = {
                    address: $(this).val()
                }

                geocoder.geocode(request, function(results, status){
                    if(status == google.maps.GeocoderStatus.OK){

                        var pos = results[0].geometry.location;
                        map.setCenter(pos);
                        marker.setPosition(pos);
                        setPosition(marker);
                    }
                });
                return false;
            }
        })


    });

    function setPosition(marker){
        var pos = marker.getPosition();
        $('#lat').val(pos.lat());
        $('#lng').val(pos.lng());
    }




        // var infowindow = new google.maps.InfoWindow();
        //
        // var marker, i;
        //
        // for (i = 0; i < locations.length; i++) {
        //     marker = new google.maps.Marker({
        //         position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        //         map: map
        //     });
        //
        //     google.maps.event.addListener(marker, 'click', (function(marker, i) {
        //         return function() {
        //             infowindow.setContent(locations[i][0]);
        //             infowindow.open(map, marker);
        //         }
        //     })(marker, i));
        // }





        //
        //     //si le navigateur à eu la permission d'accéder à la position on récupere les coordonées
        //     if (navigator.geolocation) {
        //         navigator.geolocation.getCurrentPosition(function(position) {
        //             var pos = {
        //                 lat: position.coords.latitude,
        //                 lng: position.coords.longitude
        //             };
        //
        //             var marker = new google.maps.Marker({
        //                 position: pos,
        //                 map: map,
        //                 title : 'Bougez le curseur',
        //                 draggable: true
        //             });
        //
        //             infoWindow.setPosition(pos);
        //             infoWindow.setContent('Vous etes ici');
        //             infoWindow.open(map, marker);
        //             map.setCenter(pos);
        //         }, function() {
        //             handleLocationError(true, infoWindow, map.getCenter());
        //         });
        //     } else {
        //         // Browser doesn't support Geolocation
        //         handleLocationError(false, infoWindow, map.getCenter());
        //
        // }
        //
        //
        //
        {#var geocoder = new google.maps.Geocoder();#}
        {#//#}
        {#google.maps.event.addListener(marker, 'drag',function(){#}
            {#setPostion(marker);#}
        {#});#}
        {#$('#search').keypress(function(e){#}
            {#if(e.keyCode == 13){#}
                {#var request = {#}
                    {#address : $(this).val()#}
                {#}#}
                {#//#}
                // geocoder.geocode(request, function(results, status){
                //     if(status == google.maps.GeocoderStatus.OK){
                //         var pos = results[0].geometry.location;
                //         map.setCenter(pos);
                //         // marker.setPosition(pos);
                //         setPostion(marker);
                //     }
                // });
                // return false;
            // }

        // });
        {#//#}
        {#//Cette fonction permet de recuperer les coordonnée lat et lng grace au drag du marker#}
        {#function setPostion(marker) {#}
            {#var pos = marker.getPosition();#}
            {#$('#inputLat').val(pos.lat());#}
            {#$('#inputLng').val(pos.lng());#}
        {#}#}


    </script>

    <script>
        $('#addFav')
            .popup({
                inline: true,
                on:'click'
            })
        ;
    </script>

{% endblock %}