{% extends 'base.html.twig' %}
 
{% block title %}Hello {{ controller_name }}!{% endblock %}


{% block body %}

    <style>
        #map {
            height: 400px;
            width: 70%;
        }
    </style>

    {#<div class="container">#}

    <div class="jumbotron" style="background-image:url('{{ asset('./build/image/background.png') }}');">
        <div class="container" style="text-align: center">
            <h1 class="display-3">Bienvenue sur Signe</h1>
        </div>
    </div>

    <div class="container">
        <div class="right menu">
            <div class="ui search">
                <div class="ui icon input">
                    <input class="prompt" type="text" id="lat" placeholder="lattitude">
                    <input class="prompt" type="text" id="lng" placeholder="longitude">
                    <i class="search icon"></i>
                </div>
                <div class="results"></div>
            </div>
        </div>
    </div>
    <div id="map" style="display: inline-block; height: 380px;">

    </div>


        <div id="liste" class="ui middle aligned divided list" style=" max-height: 380px;overflow: scroll;display: inline-block; margin-left: 10px; width: 320px; position: absolute;">
            <script>
                $(document).ready(function(){
                    $("#liste").append(
                        $("<div>").addClass("item").append(
                            $("<div>").addClass("right floated content").append(
                                $("<button>").attr("id", "addFav").addClass("ui button").text("Plus...")
                            ).append(
                                $("<div>").addClass("ui flowing popup top left transition hidden").append(
                                    $("<div>").addClass("ui three column divided center aligned grid")
                                        .append($("<a>").addClass("ui primary button").append($("<i>").addClass("star icon").text("Favoris")))
                                        .append($("<a>").addClass("ui primary button").append("<i>").addClass("phone icon").text("Appeler"))
                                        .append($("<a>").addClass("ui primary button").append("<i>").addClass("location arrow icon").text("Itineraire"))
                                )
                            ))
                            .append($("<img>").addClass("ui avatar image").attr("src", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTUBcxNrQj6HRPONKxeoEpw_PfQQYWT5g7iUFwvL0nOgjucd3EYw"))
                            .append($("<div>").addClass("content").text("lena")))
                });
            </script>
        </div>
    {#</div>#}



{% endblock %}

{% block javascripts %}



    <script>


    $(function(){
        // declaration de la position de depart
        var latlng = new google.maps.LatLng(43.6759607, 4.1334817);
        // declaration de la goglemap avec ses props
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        // declaration du marker rouge sur la map avec ses props
        var marker = new google.maps.Marker({
            position : latlng,
            map: map,
            title : 'curseur de base',
            draggable: true
        });

        // declaration d'un listener pour pouvoir récuperer la position du marker
        var geocoder = new google.maps.Geocoder();
        google.maps.event.addListener(marker, 'draggable', function () {

            setPosition(marker);
            
        })


        // Mise en place de la recherche grace a la touche entrée
        $('#search').keypress(function(e) {
            if (e.keyCode == 13){
                var request = {
                    address: $(this).val()
                }

                // Si le geocoder retourne ok, map centrer sur la recherche
                geocoder.geocode(request, function(results, status){
                    if(status == google.maps.GeocoderStatus.OK){

                        var pos = results[0].geometry.location;
                        map.setCenter(pos);
                        marker.setPosition(pos);
                        setPosition(marker);
                    }
                });
                return false;
            }
        })
    });

    // function qui permet de récupérer la latitude et la la longitude de la recherche
    function setPosition(marker){
        var pos = marker.getPosition();
        $('#lat').val(pos.lat());
        $('#lng').val(pos.lng());
    }

        //
        //     //si le navigateur à eu la permission d'accéder à la position on récupere les coordonées
        //     if (navigator.geolocation) {
        //         navigator.geolocation.getCurrentPosition(function(position) {
        //             var pos = {
        //                 lat: position.coords.latitude,
        //                 lng: position.coords.longitude
        //             };
        //
        //             var marker = new google.maps.Marker({
        //                 position: pos,
        //                 map: map,
        //                 title : 'Bougez le curseur',
        //                 draggable: true
        //             });
        //
        //             infoWindow.setPosition(pos);
        //             infoWindow.setContent('Vous etes ici');
        //             infoWindow.open(map, marker);
        //             map.setCenter(pos);
        //         }, function() {
        //             handleLocationError(true, infoWindow, map.getCenter());
        //         });
        //     } else {
        //         // Browser doesn't support Geolocation
        //         handleLocationError(false, infoWindow, map.getCenter());
        //
        // }
        //
        //
        //

    </script>

    <script>
        $('#addFav')
            .popup({
                inline: true,
                on:'click'
            })
        ;
    </script>

{% endblock %}