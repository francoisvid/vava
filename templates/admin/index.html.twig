{% extends 'base.html.twig' %}

{% block title %}admin index{% endblock %}

{% block body %}
    
    <div class="container-fluid h-100">
    <div class="row h-100">
        <aside class="col-12 col-md-2 p-0 bg-dark">
            <nav class="navbar navbar-expand navbar-dark bg-dark flex-md-column flex-row align-items-start py-2">
                <div class="collapse navbar-collapse">
                    <ul class="flex-md-column flex-row navbar-nav w-100 justify-content-between" id="adminaside">
                        <li class="nav-item">
                            <a class="nav-link pl-0 text-nowrap" href="" onclick="return false;"><i class="fa fa-bullseye fa-fw"></i> <span class="font-weight-bold">Accueil</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#users" ><i class="fa fa-heart-o fa-fw"></i> <span class="d-none d-md-inline">Utilisateurs</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#usersuppr" ><i class="fa fa-book fa-fw"></i> <span class="d-none d-md-inline">Utilisateurs supprimés</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fa fa-heart fa-fw"></i> <span class="d-none d-md-inline">Link</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fa fa-star fa-fw"></i> <span class="d-none d-md-inline">Link</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fa fa-list fa-fw"></i> <span class="d-none d-md-inline">Link</span></a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>
    
    <div class="col bg-faded py-3 admincontent" id="users">
    <h1>Tableau des utilisateurs actifs</h1>
<table id="table1" class="display col bg-faded py-3" style="width:90%">
        <thead>
            <tr>
                <th>Id</th>
                <th>Nom</th>
                <th>Prenom</th>
                <th>Mail</th>
                <th>Tel</th>
                <th>DateNaissance</th>
                <th>DateCreation</th>
{#                <th>Actif</th>
                <th>IsDeleted</th>#}
{#                <th>Sexe</th>#}
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr>
                <th>Id</th>
                <th>Nom</th>
                <th>Prenom</th>
                <th>Mail</th>
                <th>Tel</th>
                <th>DateNaissance</th>
                <th>DateCreation</th>
{#                <th>Actif</th>#}
{#                <th>IsDeleted</th>#}
{#                <th>Sexe</th>#}
                <th>actions</th>
            </tr>
        </tfoot>
</table>
    </div>
    <div class="col bg-faded py-3 admincontent" id="usersuppr">
    <h1>Tableau des utilisateurs inactifs(suppr)</h1>
        <table id="table2" class="display" style="width:90%">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Nom</th>
                        <th>Prenom</th>
                        <th>Mail</th>
                        <th>Tel</th>
                        <th>DateNaissance</th>
                        <th>DateCreation</th>
                        <th>actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                    <tr>
                        <th>Id</th>
                        <th>Nom</th>
                        <th>Prenom</th>
                        <th>Mail</th>
                        <th>Tel</th>
                        <th>DateNaissance</th>
                        <th>DateCreation</th>
                        <th>actions</th>
                    </tr>
                </tfoot>
            </table>
    </div>
    </div>
</div>
                        
{#<div class="modal" tabindex="-1" role="dialog" id="editTable1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Save changes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>#}
                        
                        
            <script>  
var cols = [{"data": "id"},{"data": "nom"},{"data": "prenom"},{"data": "mail"},{"data": "tel"},{"data": "dateNaissance"},{"data": "dateCreation"},null];
var names = null;
var datatables = null;
var table= null;
var table2= null;
$(document).ready(function() {
                $.ajax({
                method: "get",
                url: window.location+"user/actif",
                dataType: "json",
            }).done( function(response) {
                console.log((response))
                        cols = [
            {"data": "id"},
            {"data": "nom"},
            {"data": "prenom"},
            {"data": "mail"},
            {"data": "tel"},
            {"data": "dateNaissance"},
            {"data": "dateCreation"},
            null
        ];
             table=    $('#table1').DataTable({
                    language: {
                        url: "/build/DT_French.json"
                    },
                    ajax: {
                        url: window.location+"user/actif",
                        dataSrc: "data"},
                    responsive: true,
                    lengthMenu: [5, 10, 15, 20, 25, 50, 100, 150, 200],
                    pageLength: 10,
        columnDefs: [ {
        targets: -1,
        data: null,
        defaultContent: "<button id='edit' data-toggle='modal' data-target='#editTable1'>Edit.</button><button id='suppr'>Suppr.</button>"
    } ],
                    columns: cols
                });
            }).fail(function(xhr, status, error){
                alert(xhr.responseText)
                console.log(status);
                console.log(error);
            });
    
} ); 

    $('#table1 tbody').on( 'click', '#edit', function () {
        var data = table.row( $(this).parents('tr') ).data();
        alert( data["nom"] +" peut être modifié");
    } );
    $('#table1 tbody').on( 'click', '#suppr', function () {
        var data = table.row( $(this).parents('tr') ).data();
        supprUsr( data['id']);
        alert( data["nom"] +" peut être supprimé" );
            table
        .row( $(this).parents('tr') )
        .remove()
        .draw();
    } );
    
    // Partie dédiée à la table des utilisateurs supprimés
    cols = [
            {"data": "id"},
            {"data": "nom"},
            {"data": "prenom"},
            {"data": "mail"},
            {"data": "tel"},
            {"data": "dateNaissance"},
            {"data": "dateCreation"},
            null];
    table2 =    $('#table2').DataTable({
                    language: {
                        url: "/build/DT_French.json"
                    },
                    ajax: {
                        url: window.location+"user/del",
                        dataSrc: "data"},
                    responsive: true,
                    lengthMenu: [5, 10, 15, 20, 25, 50, 100, 150, 200],
                    pageLength: 10,
        columnDefs: [ {
        targets: -1,
        data: null,
{#        defaultContent: "<button id='edit2'>Edit.</button><button id='react'>react.</button>"#}
        defaultContent: "<button type='button' class='btn btn-primary' data-toggle='modal' data-target='#editTable1'>Launch demo modal</button>"
    } ],
                    columns: cols
                });
            
    

    $('#table2 tbody').on( 'click', '#edit2', function () {
        var data = table2.row( $(this).parents('tr') ).data();
        alert( data["nom"] +" peut être modifié");
    } );
    $('#table2 tbody').on( 'click', '#react', function () {
        var data = table2.row( $(this).parents('tr') ).data();
        unbanUsr( data['id']);
        alert( data["nom"] +" peut être supprimé" );
            table2
        .row( $(this).parents('tr') )
        .remove()
        .draw();
    } );
    
    
        var n = document.createElement('script');
        n.setAttribute('language', 'JavaScript');
        n.setAttribute('src', 'https://debug.datatables.net/debug.js');
        document.body.appendChild(n);
        
        
        $(function() {
  var $tabButtonItem = $('#adminaside li'),
      $tabSelect = $('#tab-select'),
      $tabContents = $('.admincontent'),
      activeClass = 'is-active';

  $tabButtonItem.first().addClass(activeClass);
  $tabContents.not(':first').hide();

  $tabButtonItem.find('a').on('click', function(e) {
    var target = $(this).attr('href');

    $tabButtonItem.removeClass(activeClass);
    $(this).parent().addClass(activeClass);
    $tabSelect.val(target);
    $tabContents.hide();
    $(target).show();
    e.preventDefault();
  });

  $tabSelect.on('change', function() {
    var target = $(this).val(),
        targetSelectNum = $(this).prop('selectedIndex');

    $tabButtonItem.removeClass(activeClass);
    $tabButtonItem.eq(targetSelectNum).addClass(activeClass);
    $tabContents.hide();
    $(target).show();
  });
});
</script>

            <script>
            $('#popup')
                .popup({
                    inline: true,
                    on:'click'
                })
            ;
        </script>
            <script src="{{ asset('build/admin.js') }}"/>
{% endblock %}
